<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√°o Hoa T·∫øt 2026 (Kh√¥ng Nh·∫°c N·ªÅn)</title>
    <style>
        body {
            background: #000;
            margin: 0;
            overflow: hidden;
            cursor: crosshair;
        }
        canvas {
            display: block;
        }
        /* --- PH·∫¶N H·ªòP QU√Ä --- */
        #gift-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            cursor: pointer;
            flex-direction: column;
        }
        #gift-box {
            font-size: 100px;
            animation: laclu 1s infinite;
        }
        #gift-text {
            color: #fff;
            font-family: Arial, sans-serif;
            margin-top: 20px;
            font-size: 20px;
            text-transform: uppercase;
        }
        @keyframes laclu {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
            100% { transform: rotate(0deg); }
        }
    </style>
</head>
<body>

    <div id="gift-overlay">
        <div id="gift-box">üéÅ</div>
        <div id="gift-text">Nh·∫•n ƒë·ªÉ m·ªü qu√† T·∫øt</div>
    </div>

    <canvas id="canvas"></canvas>

<script>
    // --- C·∫§U H√åNH √ÇM THANH (CH·ªà GI·ªÆ TI·∫æNG N·ªî, ƒê√É X√ìA NH·∫†C N·ªÄN) ---
    const explosionSoundURL = 'nophap.mp3'; 
    // ƒê√£ x√≥a d√≤ng backgroundMusicURL v√† backgroundAudio

    // H√†m ph√°t ti·∫øng n·ªï (V·∫´n gi·ªØ l·∫°i ƒë·ªÉ c√≥ ti·∫øng l√°ch t√°ch cho vui tai)
    function playSound() {
        var audio = new Audio(explosionSoundURL);
        audio.volume = 0.2; 
        audio.play().catch(function(error) { });
    }

    // --- C·∫§U H√åNH KHUNG H√åNH (GI·ªÆ NGUY√äN) ---
    window.requestAnimFrame = (function() {
        return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            function(callback) { window.setTimeout(callback, 1000 / 60); };
    })();

    var canvas = document.getElementById('canvas'),
        ctx = canvas.getContext('2d'),
        cw = window.innerWidth,
        ch = window.innerHeight,
        fireworks = [],
        particles = [],
        hue = 150,
        limiterTotal = 100,
        limiterTick = 150,
        timerTotal = 150, 
        timerTick = 150,
        mousedown = false,
        mx, my;

    canvas.width = cw;
    canvas.height = ch;

    window.addEventListener('resize', function() {
        cw = window.innerWidth;
        ch = window.innerHeight;
        canvas.width = cw;
        canvas.height = ch;
    });

    function random(min, max) {
        return Math.random() * (max - min) + min;
    }

    function calculateDistance(p1x, p1y, p2x, p2y) {
        var xDistance = p1x - p2x,
            yDistance = p1y - p2y;
        return Math.sqrt(Math.pow(xDistance, 2) + Math.pow(yDistance, 2));
    }

    // --- L·ªöP PH√ÅO BAY L√äN (GI·ªÆ NGUY√äN) ---
    function Firework(sx, sy, tx, ty, shapeType = null) {
        this.x = sx;
        this.y = sy;
        this.sx = sx;
        this.sy = sy;
        this.tx = tx;
        this.ty = ty;
        this.distanceToTarget = calculateDistance(sx, sy, tx, ty);
        this.distanceTraveled = 0;
        this.coordinates = [];
        this.coordinateCount = 3;
        while (this.coordinateCount--) {
            this.coordinates.push([this.x, this.y]);
        }
        this.angle = Math.atan2(ty - sy, tx - sx);
        this.speed = 2;
        this.acceleration = 1.05;
        this.brightness = random(50, 70);
        this.targetRadius = 1;
        this.shapeType = shapeType;
    }

    Firework.prototype.update = function(index) {
        this.coordinates.pop();
        this.coordinates.unshift([this.x, this.y]);

        if (this.targetRadius < 8) { this.targetRadius += 0.3; } else { this.targetRadius = 1; }
        this.speed *= this.acceleration;

        var vx = Math.cos(this.angle) * this.speed,
            vy = Math.sin(this.angle) * this.speed;
        this.distanceTraveled = calculateDistance(this.sx, this.sy, this.x + vx, this.y + vy);

        if (this.distanceTraveled >= this.distanceToTarget) {
            playSound(); // Ti·∫øng n·ªï v·∫´n c√≤n
            
            // --- C√ÅC H√åNH D·∫†NG (GI·ªÆ NGUY√äN) ---
            if (this.shapeType === 'heart') {
                createShapeParticles(this.tx, this.ty, getHeartPoints(3));
            } else if (this.shapeType === 'star') { 
                createShapeParticles(this.tx, this.ty, getStarPoints(3));
            } else if (this.shapeType === 'moon') { 
                createShapeParticles(this.tx, this.ty, getMoonPoints(3));
            } else if (this.shapeType === 'text') {
                createShapeParticles(this.tx, this.ty - 50, getTextPoints("CH√öC M·ª™NG NƒÇM M·ªöI", 30));
            } else {
                createParticles(this.tx, this.ty);
            }
            fireworks.splice(index, 1);
        } else {
            this.x += vx;
            this.y += vy;
        }
    }

    Firework.prototype.draw = function() {
        ctx.beginPath();
        ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
        ctx.lineTo(this.x, this.y);
        ctx.strokeStyle = 'hsl(' + hue + ', 100%, ' + this.brightness + '%)';
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(this.tx, this.ty, this.targetRadius, 0, Math.PI * 2);
        ctx.stroke();
    }

    // --- L·ªöP H·∫†T N·ªî (GI·ªÆ NGUY√äN) ---
    function Particle(x, y) {
        this.x = x;
        this.y = y;
        this.coordinates = [];
        this.coordinateCount = 5;
        while (this.coordinateCount--) { this.coordinates.push([this.x, this.y]); }
        this.angle = random(0, Math.PI * 2);
        this.speed = random(1, 10);
        this.friction = 0.96; 
        this.gravity = 0.5; 
        this.hue = random(hue - 50, hue + 50);
        this.brightness = random(50, 80);
        this.alpha = 1;
        this.decay = random(0.001, 0.004); 
    }

    Particle.prototype.update = function(index) {
        this.coordinates.pop();
        this.coordinates.unshift([this.x, this.y]);
        this.speed *= this.friction;
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed + this.gravity;
        this.alpha -= this.decay;
        if (this.alpha <= this.decay) { particles.splice(index, 1); }
    }

    Particle.prototype.draw = function() {
        ctx.beginPath();
        ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
        ctx.lineTo(this.x, this.y);
        ctx.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
        ctx.stroke();
    }

    function createParticles(x, y) {
        var particleCount = 50;
        while (particleCount--) { particles.push(new Particle(x, y)); }
    }

    function createShapeParticles(x, y, points) {
        for (var i = 0; i < points.length; i++) {
            var p = new Particle(x, y);
            p.x = x + points[i].x;
            p.y = y + points[i].y;
            p.speed = 0.1; 
            p.coordinates = [];
            var coordCount = 5;
            while (coordCount--) { p.coordinates.push([p.x, p.y]); }
            particles.push(p);
        }
    }

    function getHeartPoints(scale) {
        var points = [];
        for (var t = 0; t < Math.PI * 2; t += 0.1) {
            var hx = 16 * Math.pow(Math.sin(t), 3);
            var hy = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
            points.push({x: hx * scale, y: -hy * scale});
        }
        return points;
    }

    // H√†m l·∫•y ƒëi·ªÉm Ng√¥i Sao (Gi·ªØ nguy√™n)
    function getStarPoints(scale) {
        var points = [];
        var r = 15 * scale;
        for (var i = 0; i < 5; i++) {
            points.push({
                x: Math.cos((18 + i * 72) / 180 * Math.PI) * r * 2,
                y: -Math.sin((18 + i * 72) / 180 * Math.PI) * r * 2
            });
            points.push({
                x: Math.cos((54 + i * 72) / 180 * Math.PI) * r,
                y: -Math.sin((54 + i * 72) / 180 * Math.PI) * r
            });
        }
        var fullPoints = [];
        for (var j = 0; j < points.length; j++) {
            var p1 = points[j];
            var p2 = points[(j + 1) % points.length];
            for (var k = 0; k < 5; k++) {
                fullPoints.push({
                    x: p1.x + (p2.x - p1.x) * (k / 5),
                    y: p1.y + (p2.y - p1.y) * (k / 5)
                });
            }
        }
        return fullPoints;
    }

    // H√†m l·∫•y ƒëi·ªÉm M·∫∑t TrƒÉng (Gi·ªØ nguy√™n)
    function getMoonPoints(scale) {
        var points = [];
        var r = 10 * scale; 
        for (var t = 0; t < Math.PI * 2; t += 0.1) {
            points.push({x: r * Math.cos(t), y: r * Math.sin(t)});
        }
        return points.filter(p => p.x > -5 * scale); 
    }

    function getTextPoints(text, fontSize) {
        var hiddenCanvas = document.createElement('canvas');
        var hiddenCtx = hiddenCanvas.getContext('2d');
        hiddenCanvas.width = 1000;
        hiddenCanvas.height = fontSize * 3;
        hiddenCtx.font = 'bold ' + fontSize + 'px Arial, sans-serif';
        hiddenCtx.fillStyle = '#FFF';
        hiddenCtx.textAlign = 'center';
        hiddenCtx.textBaseline = 'middle';
        hiddenCtx.fillText(text, hiddenCanvas.width / 2, hiddenCanvas.height / 2);

        var imageData = hiddenCtx.getImageData(0, 0, hiddenCanvas.width, hiddenCanvas.height);
        var data = imageData.data;
        var points = [];
        for (var i = 0; i < data.length; i += 4 * 3) {
            if (data[i + 3] > 128) {
                var px = (i / 4) % hiddenCanvas.width;
                var py = Math.floor((i / 4) / hiddenCanvas.width);
                points.push({x: px - hiddenCanvas.width / 2, y: py - hiddenCanvas.height / 2});
            }
        }
        return points;
    }

    // --- BI·∫æN KI·ªÇM SO√ÅT V√íNG L·∫∂P ---
    var isRunning = false;

    function loop() {
        if (!isRunning) return; 

        requestAnimFrame(loop);
        hue += 0.5;

        ctx.globalCompositeOperation = 'destination-out';
        ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
        ctx.fillRect(0, 0, cw, ch);
        ctx.globalCompositeOperation = 'lighter';

        var i = fireworks.length;
        while (i--) {
            fireworks[i].draw();
            fireworks[i].update(i);
        }

        var i = particles.length;
        while (i--) {
            particles[i].draw();
            particles[i].update(i);
        }

        if (timerTick >= timerTotal) {
            if (!mousedown) {
                var chance = random(0, 100);
                var shape = null;
                
                // T·ª∂ L·ªÜ XU·∫§T HI·ªÜN (GI·ªÆ NGUY√äN)
                if (chance > 92) { shape = 'text'; } 
                else if (chance > 80) { shape = 'heart'; }
                else if (chance > 65) { shape = 'star'; } 
                else if (chance > 50) { shape = 'moon'; } 

                var targetX = shape === 'text' ? cw / 2 : random(0, cw);
                var targetY = shape === 'text' ? ch / 3 : random(0, ch / 2);

                fireworks.push(new Firework(random(0, cw), ch, targetX, targetY, shape));
                timerTick = 0;
            }
        } else {
            timerTick++;
        }

        if (limiterTick >= limiterTotal) {
            if (mousedown) {
                fireworks.push(new Firework(cw / 2, ch, mx, my));
                limiterTick = 0;
            }
        } else {
            limiterTick++;
        }
    }

    canvas.addEventListener('mousemove', function(e) {
        mx = e.pageX - canvas.offsetLeft;
        my = e.pageY - canvas.offsetTop;
    });

    // --- K√çCH HO·∫†T H·ªòP QU√Ä (KH√îNG PH√ÅT NH·∫†C N·ªÆA) ---
    document.getElementById('gift-overlay').addEventListener('click', function() {
        this.style.display = 'none'; // ·∫®n h·ªôp qu√†
        
        // Ch·ªâ ch·∫°y v√≤ng l·∫∑p ph√°o hoa, kh√¥ng ch·∫°y nh·∫°c
        isRunning = true;
        loop();
    });

    canvas.addEventListener('mousedown', function(e) {
        e.preventDefault();
        mousedown = true;
    });

    canvas.addEventListener('mouseup', function(e) {
        e.preventDefault();
        mousedown = false;
    });
</script>
</body>
</html>
