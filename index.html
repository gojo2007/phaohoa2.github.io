<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√°o Hoa T·∫øt 2026</title>
    <style>
        body {
            background: #000;
            margin: 0;
            overflow: hidden;
            cursor: crosshair;
        }
        canvas {
            display: block;
        }
        /* --- STYLE H·ªòP QU√Ä --- */
        #gift-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            cursor: pointer;
            flex-direction: column;
        }
        #gift-box {
            font-size: 100px;
            animation: laclu 1s infinite;
        }
        #gift-text {
            color: #fff;
            font-family: Arial, sans-serif;
            margin-top: 20px;
            font-size: 20px;
            text-transform: uppercase;
            text-shadow: 0 0 10px yellow;
        }
        @keyframes laclu {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
            100% { transform: rotate(0deg); }
        }
    </style>
</head>
<body>

    <div id="gift-overlay">
        <div id="gift-box">üéÅ</div>
        <div id="gift-text">Nh·∫•n ƒë·ªÉ m·ªü qu√† & nghe nh·∫°c T·∫øt</div>
    </div>

    <canvas id="canvas"></canvas>

<script>
    // --- C·∫§U H√åNH √ÇM THANH ---
    
    // ƒê√£ x√≥a d√≤ng nophap.mp3 theo y√™u c·∫ßu
    
    // S·ª≠a t√™n file nh·∫°c n·ªÅn th√†nh nophao.mp4
    const backgroundMusicURL = 'nophao.mp4'; 

    var backgroundAudio = new Audio(backgroundMusicURL);
    backgroundAudio.loop = true; 
    backgroundAudio.volume = 1.0;
    var musicStarted = false;

    // H√†m ph√°t ti·∫øng n·ªï (ƒê√£ ƒë·ªÉ tr·ªëng v√¨ x√≥a file n·ªï)
    function playSound() {
        // Kh√¥ng l√†m g√¨ c·∫£
    }

    // --- C·∫§U H√åNH KHUNG H√åNH ---
    window.requestAnimFrame = (function() {
        return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            function(callback) { window.setTimeout(callback, 1000 / 60); };
    })();

    var canvas = document.getElementById('canvas'),
        ctx = canvas.getContext('2d'),
        cw = window.innerWidth,
        ch = window.innerHeight,
        fireworks = [],
        particles = [],
        hue = 150,
        limiterTotal = 100,
        limiterTick = 150,
        timerTotal = 150, 
        timerTick = 150,
        mousedown = false,
        mx, my;

    canvas.width = cw;
    canvas.height = ch;

    window.addEventListener('resize', function() {
        cw = window.innerWidth;
        ch = window.innerHeight;
        canvas.width = cw;
        canvas.height = ch;
    });

    function random(min, max) {
        return Math.random() * (max - min) + min;
    }

    function calculateDistance(p1x, p1y, p2x, p2y) {
        var xDistance = p1x - p2x,
            yDistance = p1y - p2y;
        return Math.sqrt(Math.pow(xDistance, 2) + Math.pow(yDistance, 2));
    }

    // --- L·ªöP PH√ÅO BAY L√äN ---
    function Firework(sx, sy, tx, ty, shapeType = null) {
        this.x = sx;
        this.y = sy;
        this.sx = sx;
        this.sy = sy;
        this.tx = tx;
        this.ty = ty;
        this.distanceToTarget = calculateDistance(sx, sy, tx, ty);
        this.distanceTraveled = 0;
        this.coordinates = [];
        this.coordinateCount = 3;
        while (this.coordinateCount--) {
            this.coordinates.push([this.x, this.y]);
        }
        this.angle = Math.atan2(ty - sy, tx - sx);
        this.speed = 2;
        this.acceleration = 1.05;
        this.brightness = random(50, 70);
        this.targetRadius = 1;
        this.shapeType = shapeType;
    }

    Firework.prototype.update = function(index) {
        this.coordinates.pop();
        this.coordinates.unshift([this.x, this.y]);

        if (this.targetRadius < 8) { this.targetRadius += 0.3; } else { this.targetRadius = 1; }
        this.speed *= this.acceleration;

        var vx = Math.cos(this.angle) * this.speed,
            vy = Math.sin(this.angle) * this.speed;
        this.distanceTraveled = calculateDistance(this.sx, this.sy, this.x + vx, this.y + vy);

        if (this.distanceTraveled >= this.distanceToTarget) {
            playSound(); 
            
            if (this.shapeType === 'heart') {
                createShapeParticles(this.tx, this.ty, getHeartPoints(3));
            } else if (this.shapeType === 'star') { 
                createShapeParticles(this.tx, this.ty, getStarPoints(3));
            } else if (this.shapeType === 'moon') { 
                createShapeParticles(this.tx, this.ty, getMoonPoints(3));
            } else if (this.shapeType === 'text') {
                createShapeParticles(this.tx, this.ty - 50, getTextPoints("CH√öC M·ª™NG NƒÇM M·ªöI", 30));
            } else {
                createParticles(this.tx, this.ty);
            }
            fireworks.splice(index, 1);
        } else {
            this.x += vx;
            this.y += vy;
        }
    }

    Firework.prototype.draw = function() {
        ctx.beginPath();
        ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
        ctx.lineTo(this.x, this.y);
        ctx.strokeStyle = 'hsl(' + hue + ', 100%, ' + this.brightness + '%)';
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(this.tx, this.ty, this.targetRadius, 0, Math.PI * 2);
        ctx.stroke();
    }

    // --- L·ªöP H·∫†T N·ªî ---
    function Particle(x, y) {
        this.x = x;
        this.y = y;
        this.coordinates = [];
        this.coordinateCount = 5;
        while (this.coordinateCount--) { this.coordinates.push([this.x, this.y]); }
        this.angle = random(0, Math.PI * 2);
        this.speed = random(1, 10);
        this.friction = 0.96; 
        this.gravity = 0.5; 
        this.hue = random(hue - 50, hue + 50);
        this.brightness = random(50, 80);
        this.alpha = 1;
        this.decay = random(0.001, 0.004); 
    }

    Particle.prototype.update = function(index) {
        this.coordinates.pop();
        this.coordinates.unshift([this.x, this.y]);
        this.speed *= this.friction;
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed + this.gravity;
        this.alpha -= this.decay;
        if (this.alpha <= this.decay) { particles.splice(index, 1); }
    }

    Particle.prototype.draw = function() {
        ctx.beginPath();
        ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
        ctx.lineTo(this.x, this.y);
        ctx.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
        ctx.stroke();
    }

    function createParticles(x, y) {
        var particleCount = 50;
        while (particleCount--) { particles.push(new Particle(x, y)); }
    }

    function createShapeParticles(x, y, points) {
        for (var i = 0; i < points.length; i++) {
            var p = new Particle(x, y);
            p.x = x + points[i].x;
            p.y = y + points[i].y;
            p.speed = 0.1; 
            p.coordinates = [];
            var coordCount = 5;
            while (coordCount--) { p.coordinates.push([p.x, p.y]); }
            particles.push(p);
        }
    }

    // --- C√ÅC H√ÄM T·∫†O H√åNH ---
    function getHeartPoints(scale) {
        var points = [];
        for (var t = 0; t < Math.PI * 2; t += 0.1) {
            var hx = 16 * Math.pow(Math.sin(t), 3);
            var hy = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
            points.push({x: hx * scale, y: -hy * scale});
        }
        return points;
    }

    // H√†m Ng√¥i Sao l·∫•p l√°nh (Gi·ªØ nguy√™n t·ª´ b·∫£n ƒë·∫πp)
    function getStarPoints(scale) {
        var points = [];
        var spikes = 5;
        var outerRadius = 20 * scale; 
        var innerRadius = 8 * scale;  
        var step = Math.PI / spikes;

        var verticesX = [];
        var verticesY = [];
        for (var i = 0; i < 2 * spikes; i++) {
            var r = (i % 2 === 0) ? outerRadius : innerRadius;
            var a = i * step - Math.PI / 2;
            verticesX.push(Math.cos(a) * r);
            verticesY.push(Math.sin(a) * r);
        }

        for (var i = 0; i < verticesX.length; i++) {
            var next = (i + 1) % verticesX.length;
            var dx = verticesX[next] - verticesX[i];
            var dy = verticesY[next] - verticesY[i];
            var particleDensity = 15; 
            for (var k = 0; k < particleDensity; k++) {
                var t = k / particleDensity;
                points.push({x: verticesX[i] + dx * t, y: verticesY[i] + dy * t});
            }
        }
        for(var j=0; j < 20; j++) {
            points.push({x: random(-innerRadius, innerRadius) * 0.5, y: random(-innerRadius, innerRadius) * 0.5});
        }
        return points;
    }

    // H√†m M·∫∑t TrƒÉng r√µ n√©t (Gi·ªØ nguy√™n t·ª´ b·∫£n ƒë·∫πp)
    function getMoonPoints(scale) {
        var points = [];
        var R = 22 * scale;
        var offset = 10 * scale;
        
        for (var x = -R; x <= R; x += scale * 0.8) {
            for (var y = -R; y <= R; y += scale * 0.8) {
                var d1 = Math.sqrt(x*x + y*y); 
                var d2 = Math.sqrt((x - offset)*(x - offset) + y*y);
                
                if (d1 < R && d2 > R * 0.85) { 
                    points.push({x: x, y: y});
                }
            }
        }
        return points;
    }

    // H√†m Ch·ªØ ƒë·∫≠m n√©t (Gi·ªØ nguy√™n t·ª´ b·∫£n ƒë·∫πp)
    function getTextPoints(text, fontSize) {
        var hiddenCanvas = document.createElement('canvas');
        var hiddenCtx = hiddenCanvas.getContext('2d');
        hiddenCanvas.width = 1000;
        hiddenCanvas.height = fontSize * 4;
        
        hiddenCtx.font = '900 ' + fontSize + 'px Arial, sans-serif'; 
        hiddenCtx.fillStyle = '#FFF';
        hiddenCtx.textAlign = 'center';
        hiddenCtx.textBaseline = 'middle';
        hiddenCtx.fillText(text, hiddenCanvas.width / 2, hiddenCanvas.height / 2);

        var imageData = hiddenCtx.getImageData(0, 0, hiddenCanvas.width, hiddenCanvas.height);
        var data = imageData.data;
        var points = [];
        
        for (var i = 0; i < data.length; i += 4 * 2) { 
            if (data[i + 3] > 128) {
                var px = (i / 4) % hiddenCanvas.width;
                var py = Math.floor((i / 4) / hiddenCanvas.width);
                points.push({x: px - hiddenCanvas.width / 2, y: py - hiddenCanvas.height / 2});
            }
        }
        return points;
    }

    // --- BI·∫æN KI·ªÇM SO√ÅT V√íNG L·∫∂P ---
    var isRunning = false;

    function loop() {
        if (!isRunning) return; 

        requestAnimFrame(loop);
        hue += 0.5;

        ctx.globalCompositeOperation = 'destination-out';
        ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
        ctx.fillRect(0, 0, cw, ch);
        ctx.globalCompositeOperation = 'lighter';

        var i = fireworks.length;
        while (i--) {
            fireworks[i].draw();
            fireworks[i].update(i);
        }

        var i = particles.length;
        while (i--) {
            particles[i].draw();
            particles[i].update(i);
        }

        if (timerTick >= timerTotal) {
            if (!mousedown) {
                var chance = random(0, 100);
                var shape = null;
                
                // T·ª∂ L·ªÜ XU·∫§T HI·ªÜN
                if (chance > 92) { shape = 'text'; } 
                else if (chance > 80) { shape = 'heart'; }
                else if (chance > 65) { shape = 'star'; } 
                else if (chance > 50) { shape = 'moon'; } 

                var targetX = shape === 'text' ? cw / 2 : random(0, cw);
                var targetY = shape === 'text' ? ch / 3 : random(0, ch / 2);

                fireworks.push(new Firework(random(0, cw), ch, targetX, targetY, shape));
                timerTick = 0;
            }
        } else {
            timerTick++;
        }

        if (limiterTick >= limiterTotal) {
            if (mousedown) {
                fireworks.push(new Firework(cw / 2, ch, mx, my));
                limiterTick = 0;
            }
        } else {
            limiterTick++;
        }
    }

    canvas.addEventListener('mousemove', function(e) {
        mx = e.pageX - canvas.offsetLeft;
        my = e.pageY - canvas.offsetTop;
    });

    document.getElementById('gift-overlay').addEventListener('click', function() {
        this.style.display = 'none'; 
        backgroundAudio.play().then(function() {
            musicStarted = true;
        }).catch(function(error) {
            console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c");
        });
        isRunning = true;
        loop();
    });

    canvas.addEventListener('mousedown', function(e) {
        e.preventDefault();
        mousedown = true;
    });

    canvas.addEventListener('mouseup', function(e) {
        e.preventDefault();
        mousedown = false;
    });
</script>
</body>
</html>
